<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hearing Asymmetry Screening</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- App styles -->
    <link rel="stylesheet" href="/static/styles.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
    <!-- Floating decorative blobs (purely visual) -->
    <div id="floating-bg">
        <div class="blob b1"></div>
        <div class="blob b2"></div>
        <div class="blob b3"></div>
        <div class="grid-lines"></div>
    </div>

    <main id="main-frame" aria-live="polite">
        <!-- — LOGIN / PERSONAL INFO — -->
        <section id="login-screen" class="panel">
            <div class="panel-inner">
                <header class="panel-header">
                    <h1 class="brand">AuroHear</h1>
                    <p class="lead">Quick hearing asymmetry screening — professional & private</p>
                </header>

                <div class="glass-card">
                    <h2 class="card-title">Tell us about you</h2>
                    <p class="muted">We only need a few details. This isn't a form — it's a warm handshake.</p>

                    <form id="login-form" class="login-form" autocomplete="off">
                        <div class="row">
                            <div class="field">
                                <label for="name">First name</label>
                                <input type="text" id="name" required placeholder="e.g. Maitreya" />
                            </div>
                            <div class="field">
                                <label for="surname">Surname</label>
                                <input type="text" id="surname" required placeholder="e.g. Patel" />
                            </div>
                        </div>

                        <div class="row compact">
                            <div class="field radio-group">
                                <label>Age group</label>
                                <div class="chips">
                                    <label class="chip"><input type="radio" name="age_group" value="child" required> Child</label>
                                    <label class="chip"><input type="radio" name="age_group" value="adult"> Adult</label>
                                    <label class="chip"><input type="radio" name="age_group" value="senior"> Senior</label>
                                </div>
                            </div>

                            <div class="field radio-group">
                                <label>Gender (optional)</label>
                                <div class="chips">
                                    <label class="chip small"><input type="radio" name="gender" value="male"> M</label>
                                    <label class="chip small"><input type="radio" name="gender" value="female"> F</label>
                                    <label class="chip small"><input type="radio" name="gender" value="other"> Other</label>
                                    <label class="chip small"><input type="radio" name="gender" value="prefer_not_to_say"> Prefer not to say</label>
                                </div>
                            </div>
                        </div>

                        <div class="cta-row">
                            <button type="submit" class="btn primary large">Proceed</button>
                            <button type="button" id="demo-btn" class="btn ghost">Preview demo</button>
                        </div>
                    </form>
                </div>

                <footer class="panel-footer">
                    <small class="muted">Professional demo — not a medical diagnosis.</small>
                </footer>
            </div>
        </section>

        <!-- — WELCOME — -->
        <section id="welcome-screen" class="panel hidden">
            <div class="panel-inner center">
                <h2 class="title">Welcome to AuroHear</h2>
                <p class="lead">A fast, professional screening that highlights hearing asymmetry.</p>
                <div class="cta-row">
                    <button id="start-btn" class="btn primary large">Start Screening</button>
                </div>
                <p class="muted">Press SPACE or click to continue</p>
            </div>
        </section>

        <!-- — CONSENT — -->
        <section id="consent-screen" class="panel hidden">
            <div class="panel-inner">
                <h2 class="title">Important Notice</h2>
                <div class="glass-card narrow">
                    <ul class="bullets">
                        <li>Demo only — not clinical diagnosis.</li>
                        <li>Use over good headphones in a quiet room.</li>
                        <li>Consult a licensed audiologist for concerns.</li>
                    </ul>
                    <div class="cta-row">
                        <button id="agree-btn" class="btn success">I understand — Continue</button>
                        <button id="back-welcome-btn" class="btn ghost">Back</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- — DEVICE CHECK — -->
        <section id="device-check-screen" class="panel hidden">
            <div class="panel-inner center">
                <h2 class="title">Headphone & Channel Check</h2>
                <p class="muted">Click each ear to confirm audio and pan direction.</p>

                <div class="channel-row">
                    <button id="left-ear-btn" class="channel-btn left" aria-label="Play left ear test">
                        <div class="ear-icon">👂</div>
                        <span>Left</span>
                    </button>

                    <div class="channel-status-wrap">
                        <p id="channel-status" class="muted status"></p>
                        <small class="muted">If you can’t hear one side, check your cable/headphones</small>
                    </div>

                    <button id="right-ear-btn" class="channel-btn right" aria-label="Play right ear test">
                        <div class="ear-icon">👂</div>
                        <span>Right</span>
                    </button>
                </div>

                <div class="cta-row">
                    <button id="headphones-ready-btn" class="btn success">Headphones Ready</button>
                    <button id="back-consent-btn" class="btn ghost">Back</button>
                </div>
            </div>
        </section>

        <!-- — CALIBRATION — -->
        <section id="calibration-screen" class="panel hidden">
            <div class="panel-inner center">
                <h2 class="title">Volume calibration</h2>
                <p class="muted">Play the 1 kHz tone and adjust until comfortable.</p>
                <div class="glass-card narrow">
                    <label class="muted">Volume</label>
                    <div class="range-wrap">
                        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.3">
                        <button id="play-tone-btn" class="btn primary">Play Tone</button>
                    </div>
                    <div class="cta-row">
                        <button id="volume-set-btn" class="btn success">Volume set — Continue</button>
                        <button id="back-device-btn" class="btn ghost">Back</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- — INSTRUCTIONS — -->
        <section id="instructions-screen" class="panel hidden">
            <div class="panel-inner">
                <h2 class="title">How the test works</h2>
                <div class="glass-card">
                    <ol class="muted steps">
                        <li>Starts at a clearly audible level (~40 dB HL).</li>
                        <li>Heard → down 10 dB. Not heard → up 5 dB.</li>
                        <li>Threshold = softest level where you respond ≥50% of trials.</li>
                    </ol>
                    <div class="cta-row">
                        <button id="start-test-btn" class="btn primary large">Start Test</button>
                        <button id="back-calibration-btn" class="btn ghost">Back</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- — TESTING SCREEN — (this is where ears show) -->
        <section id="testing-screen" class="panel hidden">
            <div class="panel-inner">
                <div class="top-row">
                    <progress id="progress-bar" value="0" max="100"></progress>
                    <div class="progress-label-wrap">
                        <span id="progress-label">0%</span>
                    </div>
                </div>

                <div class="test-stage">
                    <div class="ears-wrap">
                        <!-- Left ear icon -->
                        <div id="left-ear-icon" class="ear-card ear-left ear-inactive" aria-hidden="false">
                            <div class="ear-visual">👂</div>
                            <div class="ear-caption">Left</div>
                        </div>

                        <!-- central response / info -->
                        <div class="center-response">
                            <div id="status-label" class="muted small">Testing</div>
                            <div id="test-info" class="muted small">Test info</div>

                            <div id="response-frame" class="response-frame">
                                <p id="response-status" class="muted">Preparing test... ⚙️</p>
                                <div id="response-buttons" class="response-buttons">
                                    <button id="yes-btn" class="btn success">YES — Heard</button>
                                    <button id="no-btn" class="btn danger">NO — Didn’t hear</button>
                                </div>
                            </div>
                        </div>

                        <!-- Right ear icon -->
                        <div id="right-ear-icon" class="ear-card ear-right ear-inactive" aria-hidden="false">
                            <div class="ear-visual">👂</div>
                            <div class="ear-caption">Right</div>
                        </div>
                    </div>
                </div>

                <div class="cta-row right">
                    <button id="exit-test-early" class="btn ghost">Exit</button>
                </div>
            </div>
        </section>

        <!-- — RESULTS — -->
        <section id="results-screen" class="panel hidden">
            <div class="panel-inner">
                <h2 class="title">Results</h2>
                <p id="status-text" class="muted"></p>
                <p id="recommendation" class="muted"></p>

                <div class="chart-wrap">
                    <canvas id="audiogram-chart" width="1200" height="400"></canvas>
                </div>

                <div class="table-wrap">
                    <h3 class="subtitle">Numerical Results</h3>
                    <table id="results-table">
                        <thead>
                            <tr><th>Frequency (Hz)</th><th>Left (dB HL)</th><th>Right (dB HL)</th><th>Diff (dB)</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    
                </div>

                <div class="cta-row">
                    <button id="download-results-btn" class="btn primary">Download PNG</button>
                    <button id="download-pdf-btn" class="btn primary">Download PDF</button>
                    <button id="try-again-btn" class="btn primary">Try Again</button>
                    <button id="exit-btn" class="btn danger">Exit</button>
                </div>
            </div>
        </section>
    </main>

    <!-- A small loader overlay -->
    <div id="loader-overlay" class="hidden" aria-hidden="true">
        <div class="loader">Please wait…</div>
    </div>

    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- App script -->
    <script src="/static/script.js"></script>
</body>
</html>
